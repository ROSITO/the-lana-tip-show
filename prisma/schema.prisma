// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("POSTGRES_URL") // Supporte POSTGRES_URL ou lana_POSTGRES_URL (via override dans lib/prisma.ts)
}

model Points {
  id          Int      @id @default(autoincrement())
  totalPoints Int      @default(0) @map("total_points")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  @@map("points")
}

model Transaction {
  id        Int      @id @default(autoincrement())
  type      String   // 'add' or 'remove'
  amount    Int
  reason    String
  timestamp BigInt
  createdAt DateTime @default(now()) @map("created_at")

  @@map("transactions")
}

model Conversion {
  id            Int      @id @default(autoincrement())
  name          String
  description   String
  pointsRequired Int     @map("points_required")
  emoji         String
  category      String   // 'money', 'activity', or 'gift'
  createdAt     DateTime @default(now()) @map("created_at")

  @@map("conversions")
}

model Task {
  id            Int      @id @default(autoincrement())
  name          String
  description   String
  pointsRequired Int     @map("points_required") // Valeur négative (ex: -20)
  emoji         String
  category      String   // 'chore', 'homework', 'behavior', etc.
  createdAt     DateTime @default(now()) @map("created_at")

  @@map("tasks")
}

model DailyBonus {
  id        Int      @id @default(autoincrement())
  date      DateTime @unique // Date du bonus (sans l'heure)
  checked   Boolean  @default(false) // Si le bonus a été vérifié/attribué
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("daily_bonus")
}

model WheelOfFortune {
  id        Int      @id @default(autoincrement())
  lastUsed  DateTime @map("last_used") // Dernière utilisation de la roue
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("wheel_of_fortune")
}

model BankAccount {
  id        Int      @id @default(autoincrement())
  balance   Decimal  @default(0) @db.Decimal(10, 2) // Solde en euros (ex: 12.50)
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("bank_account")
}

model BankTransaction {
  id        Int      @id @default(autoincrement())
  type      String   // 'credit' or 'debit'
  amount    Decimal  @db.Decimal(10, 2) // Montant en euros
  reason    String   // Raison de la transaction
  timestamp BigInt   // Timestamp de la transaction
  createdAt DateTime @default(now()) @map("created_at")

  @@map("bank_transactions")
}

model AdminPassword {
  id        Int      @id @default(autoincrement())
  password  String
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("admin_password")
}

model FinancialProduct {
  id          Int      @id @default(autoincrement())
  name        String   // Ex: "ETF S&P 500", "Bitcoin", "Livret A"
  description String
  emoji       String   // Emoji pour l'affichage
  interestRate Decimal @db.Decimal(5, 2) @map("interest_rate") // Taux d'intérêt annuel en % (ex: 5.50)
  durationDays Int    @map("duration_days") // Durée minimale en jours
  active      Boolean  @default(true) // Si le produit est disponible
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  investments Investment[]

  @@map("financial_products")
}

model Investment {
  id            Int      @id @default(autoincrement())
  productId     Int      @map("product_id")
  amount        Decimal  @db.Decimal(10, 2) // Montant investi
  initialAmount Decimal  @db.Decimal(10, 2) @map("initial_amount") // Montant initial (pour calcul)
  startDate     DateTime @map("start_date") // Date de début
  maturityDate  DateTime @map("maturity_date") // Date d'échéance
  status        String   @default("active") // 'active' or 'completed'
  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @updatedAt @map("updated_at")

  product       FinancialProduct @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@map("investments")
}

